#!/usr/bin/ruby

test_names = Dir['examples/*.sim'].map { |s| s.match(/\/([A-Za-z0-9_]*)/)[1] }

succesful_tests = 0
failed_tests = 0

test_names.each do |name|
  error = `./sc #{ARGV[0]} examples/#{name}.sim 2>&1`
  status = $?.exitstatus
  if status == 0
    puts ':::::::::::::::::::::::::::::::::::::::::::'
    puts "Test '#{name}' was succesful."
    succesful_tests += 1
  else
    puts ':::::::::::::::::::::::::::::::::::::::::::'
    puts "Test '#{name}' failed with output:"
    puts error
    failed_tests += 1
  end
end

total_tests = succesful_tests + failed_tests

puts '+++++++++++++++++++++++++++++++++++++++++++'
print "#{total_tests} tests #{(total_tests > 1) ? 'were' : 'was'}"
puts " run with #{succesful_tests} succesful, #{failed_tests} failed."

